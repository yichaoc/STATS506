---
title: "Group8_Alcohol_use"
author: "Yichao Chen"
date: "12/3/2019"
output:
  html_document:
    df_print: paged
---
## Introduction
Our group mainly focus on the relationship between eating habit and alcohol use of people. The relationship between some demographic variables and alcohol is also analyzed. Zero inflation negative binomial regression model is used in our analysis process. The reason of choosing this model is explained below and the final results of our model will be illuminate as well.

## data
Three datasets from NHANES 2005-2006  are used:\newline
1.Alcohol Use (ALQ_D.xpt)\newline
2.Diet Behavior & Nutrition (DBQ_D.xpt)\newline
3.Demographic Variables & Sample Weights (DEMO_D.xpt)\newline

From these three datasets, we choose the following variable:
ALQ130 - Avg # alcoholic drinks/day -past 12 mos (1-32:range of values)\newline
DBQ700 - How healthy is the diet (1-5:Excellent-poor)\newline
DBD091 - # of times/wk eat meals not from a home (1-21:range of values)\newline
RIAGENDR - Gender (1:Male 2:Female)\newline
RIDAGEYR - Age at Screening Adjudicated - Recode (0-84:range of values)\newline
INDFMPIR - Family PIR (0-5:a ratio of family income to poverty threshold)\newline

Here we only focus on adults and select samples with age>=21.

## Methods
R (data.table,pscl)

## Analysis

### Data Cleaning
Firstly, the datasets are cleaned. All the missing values are deleted and three datasets are joined. Here, the package of data.table is used. Details could be seen in comments. In this process, we rename the variables for convenience: ALQ130:alq_drink, DBD091: meal_out, DBQ700:diet, RIAGENDR :gender, RIDAGEYR:age, INDFMPIR:pir.

```{r}
library(foreign)
library(data.table)
AL=read.xport('./ALQ_D.xpt')
write.csv(AL,file='./ALQ_D.csv')
DBQ=read.xport('./DBQ_D.xpt')
write.csv(DBQ,file='./DBQ_D.csv')
DEMO=read.xport('./DEMO_D.xpt')
write.csv(DEMO,file='./DEMO_D.csv')
ALQ_D= fread('./ALQ_D.csv')
DBQ_D=fread('./DBQ_D.csv')
DEMO_D=fread('./DEMO_D.csv')
# delete missing values of ALQ30 ane rename ALQ30 as alq_drink
# In the original data <1 drink  are recorded as 1, we replace 1 with 0 here
A1=ALQ_D[ALQ130!=''&ALQ130!=999,.(SEQN,alq_drink=ALQ130)][alq_drink==1,alq_drink:=0]
# delete missing values of DBD091 and DBQ700
# DBD091:5555(representing >21) consider as 21; 6666(representing <1) consider as 0
# rename DBD091 as meal_out; rename DBQ700 as diet
DBQ1=DBQ_D[DBD091!=''&DBD091!=7777&DBD091!=9999&DBQ700!=''&DBQ700!=7&DBQ700!=9][
  DBD091==6666,DBD091:=0][DBD091==5555,DBD091:=21][
    ,.(SEQN,meal_out=DBD091,diet=DBQ700)]
# delete missing values of RIAGENDR,RIDAGEYR,INDFMPIR
# only focus on adults(age>=21)
# rename RIAGENDR as gender;RIDAGEYR as age; INDFMPIR as pir
DEMO1=DEMO_D[RIAGENDR!=''&RIDAGEYR!=''&RIDAGEYR>=21&INDFMPIR!=''][
  RIAGENDR==2,RIAGENDR:=0][,.(SEQN,gender=RIAGENDR,age=RIDAGEYR,pir=INDFMPIR)]
#join these three datasets together according to SEQN
data=A1[DBQ1,on='SEQN',nomatch=0L][DEMO1,on='SEQN',nomatch=0L]
```


### Basic Analysis
As observed, alq_drink is count variable, this implys that we may use possion regression or negative binomial regression, we then do some basic analysis of our response:alq_drink.
```{r}
library(ggplot2)
#calculate mean and variance
sprintf("Mean and Variance = %1.2f and %1.2f", 
        mean(data$alq_drink), var(data$alq_drink))
# histogram with alq_drink
ggplot(data,aes(alq_drink))+geom_histogram()+stat_bin(bins=25)
```
From the result, alq_drink is overdispersed as its variance is not basiclly equal to its mean.So, the negative binomial regression is more suitable in our data. From the plot, we could see that a large part of people drink alcohol less than 1. The excess zeros may be generated by a separate process from the count value alq_drink and can be modeled independently.Some people may never drink for some other reasons. So, zero-inflation model is considered.


### Build Model
The package of pscl is used for zero-inflated negative binomial regression.
The variables of diet, gender, age and pir are used in the part of negative binomial model and the variable of meal_out is used in the logit part of the model.
```{r}
library(pscl)
m1=zeroinfl(alq_drink~diet+gender+age+pir|meal_out,data=data,dist='negbin',EM=TRUE)
summary(m1)
m0 <- update(m1, . ~ 1)
pchisq(2 * (logLik(m1) - logLik(m0)), df = 5, lower.tail=FALSE)
```
From the output of chi-squared test, we know that our overall model is statistically significant. \newline
From the result of m1, the variables of diet, gender, age and pir  in the part of negative binomial are all significant predictors. The variable of meal_out in the part of the logit model predicting excessive zero is also statistically significant.\newline
The expeceted change in log(alq_drink) for one-unit increase in diet is 0.079589 holding other variable constant. From the codebook, the larger diet factor indicate poorer diet behavior. The model shows that poorer diet may related to more alcohol use.\newline
When gender change from 0 to 1, the change in log(alq_drink) is 0.544, men tends to drink more than women.\newline
The expeceted change in log(alq_drink) for one-unit increase in age is -0.016 holding other variable constant. This means when age increase, people tend to drink alcohol less.\newline
The expeceted change in log(alq_drink) for one-unit increase in age is -0.097 holding other variable constant, which means family with better finacial situation might use alcohol less.\newline
The log odds of being an excessive zero will decrease by 0.05516 for every one more meal eating outside. This means when the frequency of eating out of home is larger, the zero are less likely comes from the part of people who never use alcohol. In other words, more meals eating out of home implies more alcohol use.

We could also build a negative bionomial regression model and compares its result with the result above. The package of MASS is used for building negative bionomial regression model.

```{r}
library(MASS)
m2=glm.nb(alq_drink~diet+gender+age+pir,data=data)
vuong(m1, m2)
```
From the result of Vuong test, we could know that zero-inflated negative binomial regression have better performance and its improvement is significant.

Finally, we can compute the predicted number of alcohol use for diffrent combinations of our predictors
```{r}
newdata1 <- expand.grid(1:5, factor(0:1),21:85,0:5,1:21)
colnames(newdata1)<-c('diet','gender','age','pir','meal_out')
newdata1$alqpre<-predict(m1,newdata1)
ggplot(newdata1, aes(x = diet, y = alqpre, colour = factor(pir))) +
  geom_point() +
  facet_wrap(~gender) +
  labs(x = "diet", y = "Predicted alcohol drink counts")
```
From the plot, we could see directly that male use alcohol more, poor family pir use alcohol more and unheathier diet use alcohol more
